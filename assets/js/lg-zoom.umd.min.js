!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).lgZoom=e()}(this,function(){"use strict";var o=function(){return(o=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var s in e=arguments[o])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},i={scale:1,zoom:!0,actualSize:!0,showZoomInOutIcons:!1,actualSizeIcons:{zoomIn:"lg-zoom-in",zoomOut:"lg-zoom-out"},enableZoomAfter:300},t="lgContainerResize",e="lgBeforeOpen",s="lgAfterOpen",a="lgSlideItemLoad",r="lgAfterSlide",n="lgRotateLeft",l="lgRotateRight",g="lgFlipHorizontal",c="lgFlipVertical";function h(t,e){return this.core=t,this.$LG=e,this.settings=o(o({},i),this.core.settings),this}return h.prototype.buildTemplates=function(){var t=this.settings.showZoomInOutIcons?'<button id="'+this.core.getIdName("lg-zoom-in")+'" type="button" aria-label="Zoom in" class="lg-zoom-in lg-icon"></button><button id="'+this.core.getIdName("lg-zoom-out")+'" type="button" aria-label="Zoom out" class="lg-zoom-out lg-icon"></button>':"";this.settings.actualSize&&(t+='<button id="'+this.core.getIdName("lg-actual-size")+'" type="button" aria-label="View actual size" class="'+this.settings.actualSizeIcons.zoomIn+' lg-icon"></button>'),this.core.outer.addClass("lg-use-transition-for-zoom"),this.core.$toolbar.first().append(t)},h.prototype.enableZoom=function(t){var e=this,o=this.settings.enableZoomAfter+t.detail.delay;this.$LG("body").first().hasClass("lg-from-hash")&&t.detail.delay?o=0:this.$LG("body").first().removeClass("lg-from-hash"),this.zoomableTimeout=setTimeout(function(){e.core.getSlideItem(t.detail.index).addClass("lg-zoomable"),e.setZoomEssentials()},o+30)},h.prototype.enableZoomOnSlideItemLoad=function(){this.core.LGel.on(a+".zoom",this.enableZoom.bind(this))},h.prototype.getModifier=function(t,e,o){var i=t;t=Math.abs(t);var s=this.getCurrentTransform(o);if(!s)return 1;var a,o=1;return"X"===e?(a=Math.sign(parseFloat(s[0])),0===t||180===t?o=1:90===t&&(o=-90===i&&1===a||90===i&&-1===a?-1:1),o*=a):(a=Math.sign(parseFloat(s[3])),0===t||180===t?o=1:90===t&&(t=parseFloat(s[1]),s=parseFloat(s[2]),o=Math.sign(t*s*i*a)),o*=a),o},h.prototype.getImageSize=function(t,e,o){return t[{y:"offsetHeight",x:"offsetWidth"}[o=90===Math.abs(e)?"x"===o?"y":"x":o]]},h.prototype.getDragCords=function(t,e){return 90===e?{x:t.pageY,y:t.pageX}:{x:t.pageX,y:t.pageY}},h.prototype.getSwipeCords=function(t,e){var o=t.targetTouches[0].pageX,t=t.targetTouches[0].pageY;return 90===e?{x:t,y:o}:{x:o,y:t}},h.prototype.getDragAllowedAxises=function(t,e){e=e||this.scale||1;var o=this.imageYSize*e>this.containerRect.height,e=this.imageXSize*e>this.containerRect.width;return 90===t?{allowX:o,allowY:e}:{allowX:e,allowY:o}},h.prototype.getCurrentTransform=function(t){if(t){t=window.getComputedStyle(t,null),t=t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("-o-transform")||t.getPropertyValue("transform")||"none";return"none"!==t?t.split("(")[1].split(")")[0].split(","):void 0}},h.prototype.getCurrentRotation=function(t){if(!t)return 0;t=this.getCurrentTransform(t);return t?Math.round(Math.atan2(parseFloat(t[1]),parseFloat(t[0]))*(180/Math.PI)):0},h.prototype.setZoomEssentials=function(){var t=this.core.getSlideItem(this.core.index).find(".lg-image").first(),e=this.core.getSlideItem(this.core.index).find(".lg-img-rotate").first().get();this.rotateValue=this.getCurrentRotation(e),this.imageYSize=this.getImageSize(t.get(),this.rotateValue,"y"),this.imageXSize=this.getImageSize(t.get(),this.rotateValue,"x"),this.containerRect=this.core.outer.get().getBoundingClientRect(),this.modifierX=this.getModifier(this.rotateValue,"X",e),this.modifierY=this.getModifier(this.rotateValue,"Y",e)},h.prototype.zoomImage=function(t){var e=(this.containerRect.width-this.imageXSize)/2+this.containerRect.left,o=this.core.mediaContainerPosition,i=o.top,s=o.bottom,a=Math.abs(i-s)/2,o=(this.containerRect.height-this.imageYSize-a*this.modifierX)/2+this.scrollTop+this.containerRect.top;1===t&&(this.positionChanged=!1);var i=this.getDragAllowedAxises(Math.abs(this.rotateValue),t),s=i.allowY,a=i.allowX;this.positionChanged&&(i=this.left/(this.scale-1),r=this.top/(this.scale-1),this.pageX=Math.abs(i)+e,this.pageY=Math.abs(r)+o,this.positionChanged=!1);var r=this.getPossibleSwipeDragCords(this.rotateValue,t),e=(t-1)*(e-this.pageX),o=(t-1)*(o-this.pageY);a?this.isBeyondPossibleLeft(e,r.minX)?e=r.minX:this.isBeyondPossibleRight(e,r.maxX)&&(e=r.maxX):1<t&&(e<r.minX?e=r.minX:e>r.maxX&&(e=r.maxX)),s?this.isBeyondPossibleTop(o,r.minY)?o=r.minY:this.isBeyondPossibleBottom(o,r.maxY)&&(o=r.maxY):1<t&&(o<r.minY?o=r.minY:o>r.maxY&&(o=r.maxY)),this.setZoomStyles({x:e,y:o,scale:t})},h.prototype.setZoomStyles=function(t){var e=this.core.getSlideItem(this.core.index).find(".lg-image").first(),o=this.core.outer.find(".lg-current .lg-dummy-img").first(),i=e.parent();this.scale=t.scale,e.css("transform","scale3d("+t.scale+", "+t.scale+", 1)"),o.css("transform","scale3d("+t.scale+", "+t.scale+", 1)");o="translate3d("+t.x+"px, "+t.y+"px, 0)";i.css("transform",o),this.left=t.x,this.top=t.y},h.prototype.setActualSize=function(t,e){var o,i=this;this.core.galleryItems[this.core.index].src&&!this.core.outer.hasClass("lg-first-slide-loading")&&(o=this.getCurrentImageActualSizeScale(),this.core.outer.hasClass("lg-zoomed")?this.scale=1:this.scale=this.getScale(o),this.setPageCords(e),this.beginZoom(this.scale),this.zoomImage(this.scale),setTimeout(function(){i.core.outer.removeClass("lg-grabbing").addClass("lg-grab")},10))},h.prototype.getNaturalWidth=function(t){var e=this.core.getSlideItem(t).find(".lg-image").first(),t=this.core.galleryItems[t].width;return t?parseFloat(t):e.get().naturalWidth},h.prototype.getActualSizeScale=function(t,e){e=e<t?t/e||2:1;return e},h.prototype.getCurrentImageActualSizeScale=function(){var t=this.core.getSlideItem(this.core.index).find(".lg-image").first().get().offsetWidth,e=this.getNaturalWidth(this.core.index)||t;return this.getActualSizeScale(e,t)},h.prototype.getPageCords=function(t){var e={};return t?(e.x=t.pageX||t.targetTouches[0].pageX,e.y=t.pageY||t.targetTouches[0].pageY):(t=this.core.outer.get().getBoundingClientRect(),e.x=t.width/2+t.left,e.y=t.height/2+this.scrollTop+t.top),e},h.prototype.setPageCords=function(t){t=this.getPageCords(t);this.pageX=t.x,this.pageY=t.y},h.prototype.beginZoom=function(t){return this.core.outer.removeClass("lg-zoom-drag-transition lg-zoom-dragging"),1<t?(this.core.outer.addClass("lg-zoomed"),this.core.getElementById("lg-actual-size").removeClass(this.settings.actualSizeIcons.zoomIn).addClass(this.settings.actualSizeIcons.zoomOut)):this.resetZoom(),1<t},h.prototype.getScale=function(t){var e=this.getCurrentImageActualSizeScale();return t<1?t=1:e<t&&(t=e),t},h.prototype.init=function(){var o,i=this;this.settings.zoom&&(this.buildTemplates(),this.enableZoomOnSlideItemLoad(),o=null,this.core.outer.on("dblclick.lg",function(t){i.$LG(t.target).hasClass("lg-image")&&i.setActualSize(i.core.index,t)}),this.core.outer.on("touchstart.lg",function(t){var e=i.$LG(t.target);1===t.targetTouches.length&&e.hasClass("lg-image")&&(o?(clearTimeout(o),o=null,i.setActualSize(i.core.index,t)):o=setTimeout(function(){o=null},300),t.preventDefault())}),this.core.LGel.on(t+".zoom "+l+".zoom "+n+".zoom "+g+".zoom "+c+".zoom",function(){i.core.lgOpened&&(i.setPageCords(),i.setZoomEssentials(),i.zoomImage(i.scale))}),this.$LG(window).on("scroll.lg.zoom.global"+this.core.lgId,function(){i.core.lgOpened&&(i.scrollTop=i.$LG(window).scrollTop())}),this.core.getElementById("lg-zoom-out").on("click.lg",function(){i.core.outer.find(".lg-current .lg-image").get()&&(i.scale-=i.settings.scale,i.scale=i.getScale(i.scale),i.beginZoom(i.scale),i.zoomImage(i.scale))}),this.core.getElementById("lg-zoom-in").on("click.lg",function(){i.zoomIn()}),this.core.getElementById("lg-actual-size").on("click.lg",function(){i.setActualSize(i.core.index)}),this.core.LGel.on(e+".zoom",function(){i.core.outer.find(".lg-item").removeClass("lg-zoomable")}),this.core.LGel.on(s+".zoom",function(){i.scrollTop=i.$LG(window).scrollTop(),i.pageX=i.core.outer.width()/2,i.pageY=i.core.outer.height()/2+i.scrollTop,i.scale=1}),this.core.LGel.on(r+".zoom",function(t){t=t.detail.prevIndex;i.scale=1,i.positionChanged=!1,i.resetZoom(t),i.setZoomEssentials()}),this.zoomDrag(),this.pinchZoom(),this.zoomSwipe(),this.zoomableTimeout=!1,this.positionChanged=!1)},h.prototype.zoomIn=function(t){this.core.galleryItems[this.core.index].src&&(t?this.scale=t:this.scale+=this.settings.scale,this.scale=this.getScale(this.scale),this.beginZoom(this.scale),this.zoomImage(this.scale))},h.prototype.resetZoom=function(t){this.core.outer.removeClass("lg-zoomed lg-zoom-drag-transition");var e=this.core.getElementById("lg-actual-size"),t=this.core.getSlideItem(void 0!==t?t:this.core.index);e.removeClass(this.settings.actualSizeIcons.zoomOut).addClass(this.settings.actualSizeIcons.zoomIn),t.find(".lg-img-wrap").first().removeAttr("style"),t.find(".lg-image").first().removeAttr("style"),this.scale=1,this.left=0,this.top=0,this.setPageCords()},h.prototype.getTouchDistance=function(t){return Math.sqrt((t.targetTouches[0].pageX-t.targetTouches[1].pageX)*(t.targetTouches[0].pageX-t.targetTouches[1].pageX)+(t.targetTouches[0].pageY-t.targetTouches[1].pageY)*(t.targetTouches[0].pageY-t.targetTouches[1].pageY))},h.prototype.pinchZoom=function(){var e=this,o=0,i=!1,s=1,a=this.core.getSlideItem(this.core.index);this.core.$inner.on("touchstart.lg",function(t){a=e.core.getSlideItem(e.core.index),t.preventDefault(),2!==t.targetTouches.length||e.core.outer.hasClass("lg-first-slide-loading")||!e.$LG(t.target).hasClass("lg-item")&&!a.get().contains(t.target)||(s=e.scale||1,e.core.outer.removeClass("lg-zoom-drag-transition lg-zoom-dragging"),e.core.touchAction="pinch",o=e.getTouchDistance(t))}),this.core.$inner.on("touchmove.lg",function(t){t.preventDefault(),2===t.targetTouches.length&&"pinch"===e.core.touchAction&&(e.$LG(t.target).hasClass("lg-item")||a.get().contains(t.target))&&(t=e.getTouchDistance(t),t=o-t,(i=!i&&5<Math.abs(t)?!0:i)&&(e.scale=Math.max(1,s+.008*-t),e.zoomImage(e.scale)))}),this.core.$inner.on("touchend.lg",function(t){"pinch"===e.core.touchAction&&(e.$LG(t.target).hasClass("lg-item")||a.get().contains(t.target))&&(i=!1,o=0,e.scale<=1?e.resetZoom():(e.scale=e.getScale(e.scale),e.zoomImage(e.scale),e.core.outer.addClass("lg-zoomed")),e.core.touchAction=void 0)})},h.prototype.touchendZoom=function(t,e,o,i,s,a){var r=e.x-t.x,e=e.y-t.y,t=Math.abs(r)/s+1,s=Math.abs(e)/s+1;2<t&&(t+=1),2<s&&(s+=1),r*=t,e*=s;t=this.core.getSlideItem(this.core.index).find(".lg-img-wrap").first(),s={};s.x=this.left+r*this.modifierX,s.y=this.top+e*this.modifierY;a=this.getPossibleSwipeDragCords(a);(15<Math.abs(r)||15<Math.abs(e))&&(i&&(this.isBeyondPossibleTop(s.y,a.minY)?s.y=a.minY:this.isBeyondPossibleBottom(s.y,a.maxY)&&(s.y=a.maxY)),o&&(this.isBeyondPossibleLeft(s.x,a.minX)?s.x=a.minX:this.isBeyondPossibleRight(s.x,a.maxX)&&(s.x=a.maxX)),i?this.top=s.y:s.y=this.top,o?this.left=s.x:s.x=this.left,this.setZoomSwipeStyles(t,s),this.positionChanged=!0)},h.prototype.getZoomSwipeCords=function(t,e,o,i,s){var a,r,n={};return i?(n.y=this.top+(e.y-t.y)*this.modifierY,this.isBeyondPossibleTop(n.y,s.minY)?(a=s.minY-n.y,n.y=s.minY-a/6):this.isBeyondPossibleBottom(n.y,s.maxY)&&(a=n.y-s.maxY,n.y=s.maxY+a/6)):n.y=this.top,o?(n.x=this.left+(e.x-t.x)*this.modifierX,this.isBeyondPossibleLeft(n.x,s.minX)?(r=s.minX-n.x,n.x=s.minX-r/6):this.isBeyondPossibleRight(n.x,s.maxX)&&(r=n.x-s.maxX,n.x=s.maxX+r/6)):n.x=this.left,n},h.prototype.isBeyondPossibleLeft=function(t,e){return e<=t},h.prototype.isBeyondPossibleRight=function(t,e){return t<=e},h.prototype.isBeyondPossibleTop=function(t,e){return e<=t},h.prototype.isBeyondPossibleBottom=function(t,e){return t<=e},h.prototype.getPossibleSwipeDragCords=function(t,e){var o=e||this.scale||1,i=Math.abs(o),s=this.core.mediaContainerPosition,a=s.top,e=s.bottom,o=Math.abs(a-e)/2,s=(this.imageYSize-this.containerRect.height)/2+o*this.modifierX,a=this.containerRect.height-this.imageYSize*i+s,e=(this.imageXSize-this.containerRect.width)/2,o=this.containerRect.width-this.imageXSize*i+e,i={minY:s,maxY:a,minX:e,maxX:o};return i=90===Math.abs(t)?{minY:e,maxY:o,minX:s,maxX:a}:i},h.prototype.setZoomSwipeStyles=function(t,e){t.css("transform","translate3d("+e.x+"px, "+e.y+"px, 0)")},h.prototype.zoomSwipe=function(){var o,i,s=this,a={},e={},r=!1,n=!1,l=!1,g=new Date,c=(new Date,this.core.getSlideItem(this.core.index));this.core.$inner.on("touchstart.lg",function(t){var e;t.preventDefault(),s.core.galleryItems[s.core.index].src&&(c=s.core.getSlideItem(s.core.index),(s.$LG(t.target).hasClass("lg-item")||c.get().contains(t.target))&&1===t.targetTouches.length&&s.core.outer.hasClass("lg-zoomed")&&(g=new Date,s.core.touchAction="zoomSwipe",i=s.core.getSlideItem(s.core.index).find(".lg-img-wrap").first(),e=s.getDragAllowedAxises(Math.abs(s.rotateValue)),l=e.allowY,((n=e.allowX)||l)&&(a=s.getSwipeCords(t,Math.abs(s.rotateValue))),o=s.getPossibleSwipeDragCords(s.rotateValue),s.core.outer.addClass("lg-zoom-dragging lg-zoom-drag-transition")))}),this.core.$inner.on("touchmove.lg",function(t){t.preventDefault(),1===t.targetTouches.length&&"zoomSwipe"===s.core.touchAction&&(s.$LG(t.target).hasClass("lg-item")||c.get().contains(t.target))&&(s.core.touchAction="zoomSwipe",e=s.getSwipeCords(t,Math.abs(s.rotateValue)),t=s.getZoomSwipeCords(a,e,n,l,o),(15<Math.abs(e.x-a.x)||15<Math.abs(e.y-a.y))&&(r=!0,s.setZoomSwipeStyles(i,t)))}),this.core.$inner.on("touchend.lg",function(t){"zoomSwipe"===s.core.touchAction&&(s.$LG(t.target).hasClass("lg-item")||c.get().contains(t.target))&&(s.core.touchAction=void 0,s.core.outer.removeClass("lg-zoom-dragging"),r&&(r=!1,t=(new Date).valueOf()-g.valueOf(),s.touchendZoom(a,e,n,l,t,s.rotateValue)))})},h.prototype.zoomDrag=function(){var o,e,i,s,a=this,r={},n={},l=!1,g=!1,c=!1,h=!1;this.core.outer.on("mousedown.lg.zoom",function(t){var e;a.core.galleryItems[a.core.index].src&&(e=a.core.getSlideItem(a.core.index),(a.$LG(t.target).hasClass("lg-item")||e.get().contains(t.target))&&(o=new Date,s=a.core.getSlideItem(a.core.index).find(".lg-img-wrap").first(),e=a.getDragAllowedAxises(Math.abs(a.rotateValue)),h=e.allowY,c=e.allowX,a.core.outer.hasClass("lg-zoomed")&&a.$LG(t.target).hasClass("lg-object")&&(c||h)&&(t.preventDefault(),r=a.getDragCords(t,Math.abs(a.rotateValue)),i=a.getPossibleSwipeDragCords(a.rotateValue),l=!0,a.core.outer.get().scrollLeft+=1,--a.core.outer.get().scrollLeft,a.core.outer.removeClass("lg-grab").addClass("lg-grabbing lg-zoom-drag-transition lg-zoom-dragging"))))}),this.$LG(window).on("mousemove.lg.zoom.global"+this.core.lgId,function(t){l&&(g=!0,n=a.getDragCords(t,Math.abs(a.rotateValue)),t=a.getZoomSwipeCords(r,n,c,h,i),a.setZoomSwipeStyles(s,t))}),this.$LG(window).on("mouseup.lg.zoom.global"+this.core.lgId,function(t){l&&(e=new Date,l=!1,a.core.outer.removeClass("lg-zoom-dragging"),!g||r.x===n.x&&r.y===n.y||(n=a.getDragCords(t,Math.abs(a.rotateValue)),t=e.valueOf()-o.valueOf(),a.touchendZoom(r,n,c,h,t,a.rotateValue)),g=!1),a.core.outer.removeClass("lg-grabbing").addClass("lg-grab")})},h.prototype.closeGallery=function(){this.resetZoom()},h.prototype.destroy=function(){this.$LG(window).off(".lg.zoom.global"+this.core.lgId),this.core.LGel.off(".lg.zoom"),this.core.LGel.off(".zoom"),clearTimeout(this.zoomableTimeout),this.zoomableTimeout=!1},h});